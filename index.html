<!DOCTYPE html>
<html lang="es">

<head>
    <link rel="stylesheet" href="img/wlogo/Logo FashionStore.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FashionStore M&Vüå∏üíú</title>
    <link rel="stylesheet" href="recursos/css/index.css">
</head>

<body>
    <div class="linea-superior"></div>

    <header>
        <img src="recursos/img/wlogo/Logo FashionStore.png" alt="Logo FashionStore" width="110" height="110" class="logo">
        <h1>Bienvenido a <span>FashionStore M&V</span></h1>
        <p>Descubre nuestro cat√°logo de ropa para <b><u>Mujer</u></b> y <b><u>Hombre</u></b>.</p>

        <!-- Bot√≥n del Carrito -->
        <button id="cartButton">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="lucide lucide-shopping-cart">
                <circle cx="8" cy="21" r="1" />
                <circle cx="19" cy="21" r="1" />
                <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.72a2 2 0 0 0 2-1.58L23.95 5.5h-18.1" />
            </svg>
            <span id="cartCount">0</span>
        </button>
    </header>

    <div class="contenedor">
        <a href="#mujer" class="rectangulo">Secci√≥n Mujer</a>
        <a href="#hombre" class="rectangulo">Secci√≥n hombre</a>
        <a href="#gorras" class="rectangulo">Secci√≥n Gorras</a>
    </div>

    <!-- Buscador -->
    <div class="buscador">
        <input type="text" id="searchInput" placeholder="Buscar producto... üîç">
    </div>

    <!-- Secci√≥n Mujer -->
    <div id="mujer" class="categoria">
        <h2 style="text-align: center; background-color: #ffbce7;">Mujer:</h2>
        <section class="menu">

            <div class="menu-item" data-id="1" data-name="Enterizo Corto De Formula 1 Rojo" data-price="18000">
                <a href="productos/enterizos/mujer/EnterizoCortoDeFormula1Rojo.html">
                    <div class="img-container">
                        <img src="recursos/img/enterizos/mujer/EnterizoLargoDeFormula1Rojo.jpeg"
                            alt="Enterizo Largo De Formula 1 Rojo">
                        <div class="overlay">Ver Detalles</div>
                    </div>
                    <h3>Enterizo Corto De Formula 1 Rojo</h3>
                    <h3>$18.000</h3>
                </a>
                <button class="add-to-cart-btn" data-id="1">A√±adir al Carrito</button>
            </div>

            <div class="menu-item" data-id="2" data-name="Enterizo Corto De F√≥rmula 1 Negro" data-price="19500"
                style="background: #ff95a2;">
                <a href="productos/enterizos/mujer/EnterizoCortoDeFormula1Negro.html">
                    <div class="img-container">
                        <img src="recursos/img/enterizos/mujer/EnterizoCortoDeFormula1Negro.jpeg"
                            alt="Enterizo Corto De F√≥rmula 1 Negro">
                        <div class="overlay">Ver Detalles</div>
                    </div>
                    <h3>Enterizo Corto De F√≥rmula 1 Negro</h3>
                    <h3>$19.500</h3>
                </a>
                <button class="add-to-cart-btn" data-id="2">A√±adir al Carrito</button>
            </div>

            <div class="menu-item" data-id="3" data-name="Conjunto Deportivo Original" data-price="32000">
                <a href="productos/conjuntos/mujer/ConjuntoDeportivoOriginal.html">
                    <div class="img-container">
                        <img src="recursos/img/conjuntos/mujer/ConjuntoDeportivoOriginal.jpeg"
                            alt="Conjunto Deportivo Original">
                        <div class="overlay">Ver Detalles</div>
                    </div>
                    <h3>Conjunto Deportivo Original</h3>
                    <h3>$32.000</h3>
                </a>
                <button class="add-to-cart-btn" data-id="3">A√±adir al Carrito</button>
            </div>

        </section>
    </div>

    <!-- Secci√≥n Hombre -->
    <div id="hombre" class="categoria">
        <h2 style="text-align: center; background-color: #a2acff;">Hombre:</h2>
        <section class="menu">
            <div class="menu-item" data-id="4" data-name="Conjunto De Ni√±o" data-price="15000">
                <a href="productos/conjuntos/hombre/ConjuntoDeNi√±o.html">
                    <div class="img-container">
                        <img src="recursos/img/conjuntos/hombre/ConjuntoDeNi√±o.jpeg" alt="Conjunto De Ni√±o">
                        <div class="overlay">Ver Detalles</div>
                    </div>
                    <h3>Conjunto De Ni√±o</h3>
                    <h3>$15.000</h3>
                </a>
                <button class="add-to-cart-btn" data-id="4">A√±adir al Carrito</button>
            </div>
        </section>
    </div>

    <!-- Secci√≥n Gorras -->
    <div id="gorras" class="categoria">
        <h2 style="text-align: center; background-color: #edfff3;">Gorras:</h2>
        <section class="menu">
            <div class="menu-item" data-id="5" data-name="Gorra Roja New York" data-price="8500">
                <a href="productos/conjuntos/hombre/ConjuntoDeNi√±o.html">
                    <div class="img-container">
                        <img src="recursos/img/gorras/GorraRojaNewYork.webp" alt="Gorra Roja New York">
                        <div class="overlay">Ver Detalles</div>
                    </div>
                    <h3>Gorra Roja New York</h3>
                    <h3>$8.500</h3>
                </a>
                <button class="add-to-cart-btn" data-id="5">A√±adir al Carrito</button>
            </div>
        </section>
    </div>

    <section class="creditos">
        <h3>Para Obtener M√°s Informaci√≥n Ingresa Al Siguiente Canal De WhatsApp:</h3>
        <div class="link">
            <a href="https://whatsapp.com/channel/0029VbBSoksISTkJGZYDiK1l" class="rectangulo">Sigue el canal de
                FashionStore M&V üíú</a>
        </div>
    </section>

    <!-- Panel de Carrito -->
    <div id="cartBackdrop"></div>
    <div id="cartPanel">
        <div class="cart-header">
            <h3>Tu Pedido</h3>
            <button onclick="closeCartPanel()" style="background:none; border:none; color:#333; cursor:pointer;">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-x">
                    <path d="M18 6 6 18" />
                    <path d="m6 6 12 12" />
                </svg>
            </button>
        </div>

        <div id="cartItemsContainer">
            <p id="emptyCartMessage" style="text-align: center; color: #999; margin-top: 20px;">El carrito est√° vac√≠o.</p>
        </div>

        <div class="cart-footer">
            <div style="display:flex; justify-content:space-between; font-size:1.5rem; font-weight:700; color:#ff4eb8;">
                <span>Total:</span>
                <span id="cartTotal">$0</span>
            </div>

            <button id="checkoutButton" onclick="processOrder()">Enviar Pedido por WhatsApp</button>

            <p style="font-size: 0.8rem; color: #9d63ff; margin-top: 10px;">
                Se generar√° un C√≥digo √önico para tu confirmaci√≥n.
            </p>
        </div>
    </div>

    <script>
        const WHATSAPP_NUMBER = "56954356331";
        const CART_STORAGE_KEY = 'fashionStoreCart';
        const cartButton = document.getElementById('cartButton');
        const cartPanel = document.getElementById('cartPanel');
        const cartBackdrop = document.getElementById('cartBackdrop');
        const cartCountSpan = document.getElementById('cartCount');
        const cartItemsContainer = document.getElementById('cartItemsContainer');
        const cartTotalSpan = document.getElementById('cartTotal');
        const emptyCartMessage = document.getElementById('emptyCartMessage');
        const checkoutButton = document.getElementById('checkoutButton');
        const searchInput = document.getElementById('searchInput');
        const productItems = document.querySelectorAll('.menu-item');

        function getCart() {
            const cartString = localStorage.getItem(CART_STORAGE_KEY);
            return cartString ? JSON.parse(cartString) : [];
        }

        function saveCart(cart) {
            localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
            updateCartUI(cart);
        }

        function formatCurrency(number) {
            return new Intl.NumberFormat('es-CL', { style: 'currency', currency: 'CLP', minimumFractionDigits: 0 }).format(number);
        }

        function addItemToCart(id, name, price) {
            let cart = getCart();
            const existingItemIndex = cart.findIndex(item => item.id === id);
            if (existingItemIndex > -1) cart[existingItemIndex].quantity += 1;
            else cart.push({ id, name, price: parseFloat(price), quantity: 1 });
            saveCart(cart);
            openCartPanel();
        }

        window.changeQuantity = function (id, delta) {
            let cart = getCart();
            const itemIndex = cart.findIndex(item => item.id === id);
            if (itemIndex > -1) {
                cart[itemIndex].quantity += delta;
                if (cart[itemIndex].quantity <= 0) cart.splice(itemIndex, 1);
                saveCart(cart);
            }
        }

        window.removeItem = function (id) {
            let cart = getCart();
            cart = cart.filter(item => item.id !== id);
            saveCart(cart);
        }

        function updateCartUI(cart) {
            cartItemsContainer.innerHTML = '';
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const totalAmount = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
            cartCountSpan.textContent = totalItems;
            cartTotalSpan.textContent = formatCurrency(totalAmount);
            emptyCartMessage.style.display = cart.length === 0 ? 'block' : 'none';
            checkoutButton.disabled = cart.length === 0;

            if (cart.length > 0) {
                cart.forEach(item => {
                    const el = document.createElement('div');
                    el.className = 'cart-item';
                    el.innerHTML = `
                        <div style="flex:1;padding-right:10px;">
                            <p style="font-weight:600;margin:0;color:#7b4eff;">${item.name}</p>
                            <p style="font-size:0.9rem;color:#555;margin:0;">${formatCurrency(item.price)} c/u</p>
                        </div>
                        <div class="cart-item-controls">
                            <button onclick="changeQuantity('${item.id}',-1)">-</button>
                            <span style="font-weight:bold;">${item.quantity}</span>
                            <button onclick="changeQuantity('${item.id}',1)">+</button>
                            <button onclick="removeItem('${item.id}')" style="background:#ff4eb8;">üóëÔ∏è</button>
                        </div>`;
                    cartItemsContainer.appendChild(el);
                });
            }
        }

        function generateUniqueCode() {
            return 'FS-' + Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        window.processOrder = async function () {
            const cart = getCart();
            if (cart.length === 0) return;
            const uniqueCode = generateUniqueCode();
            const total = cart.reduce((s, i) => s + i.price * i.quantity, 0);
            const productList = cart.map(i => `- ${i.name} (x${i.quantity}) $${i.price}`).join('\n');

            const message = `
*üõçÔ∏è PEDIDO FASHIONSTORE M&V üõçÔ∏è*
*C√ìDIGO:* ${uniqueCode}

${productList}

Total: ${formatCurrency(total)}
(Por favor, ingresa tu nombre y direcci√≥n de env√≠o aqu√≠)
`;

            const encodedMessage = encodeURIComponent(message.trim());
            const whatsappUrl = `https://api.whatsapp.com/send?phone=${WHATSAPP_NUMBER}&text=${encodedMessage}`;

            // ‚úÖ Enlace universal compatible con iPhone, Android y PC
            if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                window.location.href = whatsappUrl;
            } else {
                window.open(whatsappUrl, '_blank');
            }

            localStorage.removeItem(CART_STORAGE_KEY);
            updateCartUI([]);
            closeCartPanel();
        };

        function openCartPanel() {
            cartPanel.classList.add('open');
            cartBackdrop.style.display = 'block';
        }

        window.closeCartPanel = function () {
            cartPanel.classList.remove('open');
            cartBackdrop.style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateCartUI(getCart());
            cartButton.addEventListener('click', openCartPanel);
            cartBackdrop.addEventListener('click', closeCartPanel);
            document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
                btn.addEventListener('click', e => {
                    const el = e.target.closest('.menu-item');
                    addItemToCart(el.dataset.id, el.dataset.name, el.dataset.price);
                });
            });
            searchInput.addEventListener('input', () => {
                const filtro = searchInput.value.toLowerCase();
                productItems.forEach(p => {
                    const nombre = p.querySelector('h3').textContent.toLowerCase();
                    p.style.display = nombre.includes(filtro) ? 'block' : 'none';
                });
            });
        });
    </script>

</body>
</html>

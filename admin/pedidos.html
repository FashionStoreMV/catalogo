<!doctype html><html lang="es"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Admin Pedidos</title><link rel="stylesheet" href="../recursos/css/index.css"></head><body><div style="padding:20px"><h2>Pedidos</h2><div style="margin-bottom:12px"><input id="q" placeholder="Buscar por nombre o código"><button id="btnq">Buscar</button><button id="refresh">Refrescar</button><button id="logout" style="float:right">Salir</button></div><div id="list" style="display:flex;flex-wrap:wrap;gap:12px"></div><div id="detail" style="margin-top:16px;display:none;padding:12px;background:#fff;border-radius:8px"></div></div><script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script><script>var FIREBASE_CONFIG = null; if(FIREBASE_CONFIG !== null) firebase.initializeApp(FIREBASE_CONFIG); const auth = firebase.auth(); const db = firebase.firestore(); auth.onAuthStateChanged(u=>{ if(!u) window.location.href='login.html'; else loadAll(); }); document.getElementById('logout').addEventListener('click', ()=> auth.signOut()); async function loadAll(q){ const listEl = document.getElementById('list'); listEl.innerHTML='Cargando...'; let snap = await db.collection('orders').orderBy('date','desc').limit(200).get(); let docs = snap.docs.map(d=> ({id:d.id, ...d.data()})); if(q){ const qq = q.toLowerCase(); docs = docs.filter(d=> (d.name||'').toLowerCase().includes(qq) || (d.code||'').toLowerCase().includes(qq)); } listEl.innerHTML=''; if(docs.length===0) listEl.innerHTML='<em>No hay pedidos</em>'; docs.forEach(d=>{ const div = document.createElement('div'); div.style.width='300px'; div.style.padding='12px'; div.style.background='#fff'; div.style.borderRadius='8px'; div.style.boxShadow='0 6px 14px rgba(0,0,0,0.06)'; div.innerHTML=`<strong>${d.name||''}</strong><div>${d.code||''}</div><div>Total: $${d.total||0}</div><div>Estado: ${d.status||'pendiente'}</div>`; div.addEventListener('click', ()=> showDetail(d)); listEl.appendChild(div); }); } function showDetail(d){ const det = document.getElementById('detail'); det.style.display='block'; det.innerHTML = `<h3>${d.name||''} (${d.code||''})</h3><div>Fecha: ${new Date(d.date).toLocaleString()}</div><div>Total: $${d.total||0}</div><div>Estado: ${d.status||'pendiente'}</div><h4>Productos</h4><ul>${(d.items||[]).map(it=>`<li>${it.name} talla:${it.size||''} x ${it.qty} — $${it.price}</li>`).join('')}</ul><button id="confirmBtn">Marcar como confirmado</button>`; document.getElementById('confirmBtn').onclick = async ()=>{ await db.collection('orders').doc(d.id).update({status:'confirmado'}); alert('Marcado confirmado'); loadAll(); }; } document.getElementById('btnq').addEventListener('click', ()=> loadAll(document.getElementById('q').value)); document.getElementById('refresh').addEventListener('click', ()=> loadAll());</script></body></html>
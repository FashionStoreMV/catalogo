(function(window){ const CART_KEY='cart_items_demo_v1'; function getCart(){try{return JSON.parse(localStorage.getItem(CART_KEY)||'{}')}catch(e){return {}}} function saveCart(c){localStorage.setItem(CART_KEY,JSON.stringify(c));} function addItem(item){const key=item.id+'::'+(item.size||''); const cart=getCart(); if(cart[key]) cart[key].qty=Number(cart[key].qty)+Number(item.qty); else cart[key]=item; saveCart(cart); window.dispatchEvent(new CustomEvent('cart.updated'));} function removeItem(key){const cart=getCart(); delete cart[key]; saveCart(cart); window.dispatchEvent(new CustomEvent('cart.updated'));} function clearCart(){localStorage.removeItem(CART_KEY); window.dispatchEvent(new CustomEvent('cart.updated'));} function listItems(){const c=getCart(); return Object.keys(c).map(k=>Object.assign({key:k}, c[k]));} function total(){return listItems().reduce((s,it)=>s + Number(it.price)*Number(it.qty), 0);} window.__ShopCart={addItem,removeItem,clearCart,listItems,total,getCart}; document.addEventListener('click', function(e){ const bt = e.target.closest && e.target.closest('[data-add-cart]'); if(!bt) return; const id=bt.getAttribute('data-product-id'); const name=bt.getAttribute('data-product-name')||''; const price=Number(bt.getAttribute('data-product-price')||'0'); const sizeSelector=bt.getAttribute('data-size-selector'); const qtySelector=bt.getAttribute('data-qty-selector'); const size = sizeSelector ? (document.querySelector(sizeSelector)?.value || '') : (bt.getAttribute('data-product-size')||''); const qty = qtySelector ? (Number(document.querySelector(qtySelector)?.value||1)) : Number(bt.getAttribute('data-product-qty')||1); if(!id){alert('Producto sin id'); return;} if(qty<=0){alert('Cantidad debe ser 1 o más'); return;} addItem({id,name,price,qty,size}); alert('Añadido al carrito'); });})();